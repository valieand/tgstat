Задание:

Подробно описать словами процесс реализации функциональности для сбора статистики по количеству переходов по сокращенным ссылкам, также указать какое дополнительное серверное ПО потребуется (если потребуется).

Пользователю должно быть доступно общее кол-во переходов по ссылке и кол-во переходов в разбивке по дням.

Необходимо учесть, что в пике количество переходов по ссылке может достигать 5.000 в секунду. Допускается задержка (не более чем в 1 минуту) при отображении актуальной статистики пользователю.

Ответ:

1. при обращении к ссылке закидываем инфу об обращении (id ссылки, день) в шину данных (например кафку). для это добавляем хендлер события afterSave к модели ссылки

2. создаем потребителей, которые забирают батчами но не реже чем раз в заданное время (до 1 мин). листенеры анализируют батч, суммируют кол-во переходов по каждой ссылке за день и записывают агрегированную инфу в SQL-ное хранилище колоночного типа (например clickhouse). запрос на запись вида:
INSERT INTO stat_table (ID, day, count) VALUES (1106, '2024-01-01' , 1234),... ON DUPLICATE KEY UPDATE value = value + VALUES(count);

3. партишены и потребителей масштабируем пока потребители не перестанут справляться с пиковой нагрузкой (проверяется нагрузочным тестированием, например c k6).
